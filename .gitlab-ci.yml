test:
  script:
      - echo "Test stage has been started" 
      - python3 --version ; pip --version  # For debugging
      - pip3 install -r requirements.txt --break-system-packages
      - python3 -m unittest discover tests
  tags:
    - gcp

build:
  script:
    - echo "Build stage has been started"
    - docker build -t test .
  tags:
    - gcp

deploy:
  script:
    - echo "Deploy stage has been started"
    - gcloud compute ssh myapp --zone=us-central1-a --command="sudo docker run -d nginx:alpine"
  tags:
    - gcp

stages:
  - test
  - build
  - deploy